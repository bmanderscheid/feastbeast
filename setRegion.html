<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Select Your Region</title>
</head>
<body onload="getUser()">

</body>

<script src="https://www.gstatic.com/firebasejs/3.2.0/firebase.js"></script>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyCsGWvM0qTGzqzj24hkn2xFZqqVKrUqVMI",
        authDomain: "feast-beast-1001.firebaseapp.com",
        databaseURL: "https://feast-beast-1001.firebaseio.com",
        storageBucket: "feast-beast-1001.appspot.com",
    };
    firebase.initializeApp(config);

    function getUser(){
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                var userId = firebase.auth().currentUser.uid;
                firebase.database().ref('/users/' + userId).once('value').then(function(snapshot) {
                    if(snapshot.val()){
                        var username = snapshot.val().username;
                        checkRegion()
                    }
                    else{
                        db();
                    }
                });
            }
            else {
                db();
            }
        });
    }
    
    function db(){
        var database = firebase.database();
        var user = firebase.auth().currentUser;
        console.log(user);
        firebase.database().ref('users/' + user.uid).set({
            username: user.displayName,
            email: user.email,
            profile_picture : user.photoURL
        });
    }

    function checkRegion() {
        var userId = firebase.auth().currentUser.uid;
        firebase.database().ref('/users/' + userId + '/region').once('value').then(function(snapshot) {
            if(snapshot.val()){
                console.log(snapshot.val());
            }
            else{
                firebase.database().ref('/users/' + userId + '/').update({
                    window.location = "setRegion2.html";
                });
            }
        });
    }
    
</script>
</html>